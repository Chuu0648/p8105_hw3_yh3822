---
title: "p8105_hw3_yh3822"
output: github_document
date: "2024-10-12"
---

```{r set up}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message=FALSE)
library(tidyverse)
library(readxl)
library(dplyr)
library(p8105.datasets)
library(gridExtra)
```


## Problem 1

```{r}
data("ny_noaa")
str(ny_noaa)
summary(ny_noaa)
```


```{r}
missing_data_summary = ny_noaa %>%
  summarize(
    missing_tmax = mean(is.na(tmax)),
    missing_tmin = mean(is.na(tmin)),
    missing_prcp = mean(is.na(prcp)),
    missing_snow = mean(is.na(snow)),
    missing_snwd = mean(is.na(snwd ))
  )
missing_data_summary
```

This dataset contains the weather data of New York state weather stations from January 1, 1981 through December 31, 2010, including seven variables, which are id, date, prcp, snow, snwd, tmax, and tmin. Among them, "prcp" means the precipitation (tenths of mm), "snow" means the snowfall (mm), "snwd" means the depth of snow (mm), "tmax" means the maximum temperature (tenths of degrees C), and "tmin" means the minimum temperature (tenths of degrees C). There are totally `r nrow(ny_noaa)` rows and `r ncol(ny_noaa)` columns. We found out that about 43.7 percent of the "tmin" and "tmax" are missing, which would seriously affect the analysis of temperatures and it's a big issue.




```{r}
ny_noaa$id = as.factor(ny_noaa$id)
ny_noaa$tmin = as.numeric(ny_noaa$tmin)
ny_noaa$tmax = as.numeric(ny_noaa$tmax)
ny_noaa_clean = ny_noaa %>%
  janitor::clean_names() %>%
  filter(!is.na(tmax), !is.na(tmin)) %>%
  mutate(
    year = year(date),
    month = month(date),
    day = day(date)
  )
```


```{r}
ny_noaa_clean = ny_noaa_clean %>%
  mutate(
    tmax = tmax / 10,    
    tmin = tmin / 10, 
    prcp = prcp / 10
  )
```



```{r}
ny_noaa_clean |>
  count(snow, sort = TRUE)
```

For snowfall, 0 is the most commonly observed value, followed by NA value and 25. It's because snow does not fall for most of the year.



```{r}
ny_noaa_clean |>
  filter(month %in% c(1, 7)) |>
  group_by(id, year, month) |>
  summarize(mean_tmax = mean(tmax), na.rm = TRUE) |>
  ggplot(aes(x = year, y = mean_tmax)) +
  geom_point(alpha = 0.3) + 
  geom_line() +
  facet_grid(~ month) +
  labs(
    title = "Average Maximum Temperature in January and July",
    x = "Year",
    y = "Average Maximum Temperature (C)"
  ) +
  theme_minimal()
```

From the graph we can clearly see that the average maximum temperatures in January are basically in the range of -10 to 10 degrees Celsius, while the average maximum temperatures in July are almost in the range of 20 to 35 degrees Celsius, with a few notable outliers in both graphs.


```{r}
tmax_tmin_plot = ggplot(ny_noaa_clean, aes(x = tmin, y = tmax)) +
  geom_bin_2d() + 
  labs(
    title = "tmax vs tmin",
    x = "Minimum Temperature (C)",
    y = "Maximum Temperature (C)"
  ) +
  theme_minimal()
```



```{r}
snowfall_plot_data <- ny_noaa_clean %>%
  filter(snow > 0, snow < 100)
snowfall_plot = ggplot(snowfall_plot_data, aes(x = snow)) +
  geom_histogram(binwidth = 5, fill = "blue", color = "white") +
  facet_wrap(~ year) +
  labs(
    title = "Distribution of Snowfall by Year",
    x = "Snowfall (mm)",
    y = "Count"
  ) +
  theme_minimal()
```


```{r}
grid.arrange(tmax_tmin_plot, snowfall_plot, ncol = 2)
```


## Problem 2


```{r, message=FALSE, warning=FALSE}
nhanes_accel_df = read_csv("./data/nhanes_accel.csv") 
nhanes_covar_df = read_csv("./data/nhanes_covar.csv", skip = 4)
```



```{r}
nhanes_accel_clean = nhanes_accel_df %>%
  janitor::clean_names() %>%
  mutate(across(starts_with("min"), ~ round(., 2)))
nhanes_covar_clean = nhanes_covar_df %>%
  janitor::clean_names() %>%
  mutate(sex = factor(sex, level = c(1, 2), labels = c("male", "female")),
                      education = factor(education, 
                                         levels = c(1, 2, 3), 
                                         labels = c("Less than high school", "High school equivalent", "More than high school"))
                      ) %>%
  drop_na(seqn, sex, age, bmi, education)
```





